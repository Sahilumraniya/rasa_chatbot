version: "3.1"

rules:
- rule: Handle greeting
  # This rule starts the conversation and the form
  condition:
    - slot_was_set:
        - user_name: null
  steps:
    - intent: greet
    - action: utter_greet_no_name
    - action: name_form
    - active_loop: name_form

- rule: Handle form submission
  # This rule runs after the form gets the name
  condition:
  - active_loop: name_form
  steps:
    - action: name_form
    - active_loop: null
    - action: utter_greet_with_name

- rule: Handle greeting (user already has name)
  condition:
    - slot_was_set:
        - user_name: true
  steps:
    - intent: greet
    - action: utter_greet_with_name

- rule: Handle goodbye (with name)
  condition:
    - slot_was_set:
        - user_name: true
  steps:
    - intent: goodbye
    - action: utter_goodbye_with_name

- rule: Handle goodbye (no name)
  condition:
    - slot_was_set:
        - user_name: null
  steps:
    - intent: goodbye
    - action: utter_goodbye_no_name

- rule: Handle all unknown questions
  # This runs when NO form is active
  # The 'priority' key has been removed to fix your error.
  condition:
  - active_loop: null
  steps:
    - intent: nlu_fallback
    - action: action_vector_reasoner

- rule: Handle vulgarity
  condition:
    - active_loop: null
  steps:
    - intent: vulgarity
    - action: utter_vulgarity
